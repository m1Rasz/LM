<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <title>lm-shop</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/Ofstyle.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="icon" href="images/fevicon.png" type="image/gif" />
    <link rel="stylesheet" href="css/jquery.mCustomScrollbar.min.css">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
    <link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Great+Vibes|Poppins:400,700&display=swap&subset=latin-ext" rel="stylesheet">
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesoeet" href="css/owl.theme.default.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">

</head>
<body>
    <div class="banner_bg_main">
        <div class="container">
            <div class="header_section_top">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="custom_menu">
                            <ul>
                                <li><a href="#">coś</a></li>
                                <li><a href="#">coś</a></li>
                                <li><a href="#">coś</a></li>
                                <li><a href="#">coś</a></li>
                                <li><a href="#">Obsługa klienta</a></li>
                            </ul>
                        </div>
                    </div>
                </div>

            </div>

        </div>

        <!-- header section end -->
        <!-- banner section start -->


        <div class="logo"><a href="Main.html"><img src="images/logo.png"></a></div>
        <div class="header_section">
            <div class="container">
                <div class="containt_main">
                    <div id="mySidenav" class="sidenav">
                        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
                        <a href="index.html">Home</a>
                        <a href="">coś</a>
                        <a href="">coś</a>
                        <a href="">coś</a>
                    </div>
                    <span class="toggle_icon" onclick="openNav()"><img src="images/toggle-icon.png"></span>
                    <div class="main">
                        <!-- Another variation with a button -->
                    </div>
                    <div class="header_box">
                        <div class="login_menu">
                            <ul>
                                <li>
                                    <a href="cart.html">
                                        <i class="fa fa-shopping-cart" aria-hidden="true"></i>
                                        <span class="padding_10">Koszyk</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="HTMLPage1.html">
                                        <i class="fa fa-user" aria-hidden="true"></i>
                                        <span class="padding_10">Kontakt</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="large_box">
                <div class="product-container">
                    <div class="product-info">
                        <h2></h2>
                        <p></p>
                    </div>
                </div>
                <div class="purchase-container">
                    <div class="purchase-info">
                        <p class="total-amount">Cena: <strong></strong></p>
                        <button class="buy-now" data-shoppy-product="">Zamów teraz</button>
                        <button class="cart">Dodaj do koszyka</button>
                        <p class="payment"><strong>Metody płatności</strong></p>
                    </div>
                </div>
            </div>
        </div>


    </div>


    <!-- footer section end -->
    <!-- copyright section start -->

    <div class="copyright_section">
        <div class="footer_logo">
            <a href="Main.html"><img src="images/footer-logo.png" alt="Footer Logo"></a>
        </div>
        <div class="text_section">
            <div class="location_main">
                If you need help, contact us : <a href="#">help@mail.com</a>
            </div>
            <div class="copyright_text">
                © 2024 All Rights Reserved. Design by
            </div>
        </div>
    </div>

    <!-- copyright section end -->
    <!-- Javascript files-->
    <script src="js/jquery.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/jquery-3.0.0.min.js"></script>
    <script src="js/plugin.js"></script>
    <script src="js/tstrony.js"></script>
    <script src="js/oferty.json"></script>
    <script src="js/przewijanie.js"></script>
    <script src="js/leftpanel.js"></script>

    <script src="https://shoppy.gg/api/embed.js"></script>
    <!-- sidebar -->
    <script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="js/custom.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const button = document.querySelector('.cart');

            button.addEventListener('click', () => {
                // Pobierz ID z URL
                const params = new URLSearchParams(window.location.search);
                const offerId = params.get('id');

                if (!offerId) {
                    alert('Brak ID oferty w adresie URL!');
                    return;
                }

                // Pobierz dane z `strony.json`
                fetch('strony.json')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Błąd podczas ładowania pliku JSON');
                        }
                        return response.json();
                    })
                    .then(offers => {
                        // Znajdź ofertę po ID
                        const offer = offers.find(o => o.id == offerId);
                        if (!offer) {
                            alert('Nie znaleziono oferty o podanym ID!');
                            return;
                        }

                        // Przygotuj dane do koszyka
                        const cartItem = {
                            id: offer.id,
                            szczegoly: offer.szczegoly[0], // Pierwsza linia szczegółów
                            cena: offer.cena,
                            shoppyProductCode: offer.shoppyProductCode
                        };

                        // Sprawdź, czy oferta już jest w koszyku
                        const cart = JSON.parse(localStorage.getItem('cart')) || [];
                        const isDuplicate = cart.some(item => item.id == cartItem.id);

                        if (isDuplicate) {
                            alert('Ta oferta już znajduje się w koszyku!');
                            return;
                        }

                        // Dodaj do LocalStorage, jeśli oferta nie jest duplikatem
                        cart.push(cartItem);
                        localStorage.setItem('cart', JSON.stringify(cart));

                        alert(`Dodano do koszyka: ${cartItem.szczegoly}`);

                        // Aktualizuj wyświetlenie koszyka na stronie
                        updateCartView();
                    })
                    .catch(error => {
                        console.error('Błąd:', error);
                        alert('Wystąpił problem podczas dodawania do koszyka.');
                    });
            });

            // Funkcja do aktualizacji widoku koszyka
            function updateCartView() {
                const cartContainer = document.getElementById('cart-items');
                if (!cartContainer) return;

                const cart = JSON.parse(localStorage.getItem('cart')) || [];

                if (cart.length === 0) {
                    cartContainer.innerHTML = '<p>Twój koszyk jest pusty.</p>';
                    return;
                }

                cartContainer.innerHTML = '';

                cart.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.classList.add('cart-item');

                    const zamowButton = item.shoppyProductCode
                        ? `<button class="button buy-now" data-shoppy-product="${item.shoppyProductCode}">
                            Zamów teraz
                        </button>`
                        : '';

                    itemDiv.innerHTML = `
                        <div class="cart-item-details">
                            <p>${item.szczegoly}</p>
                            <p><strong>Cena:</strong> ${item.cena}</p>
                        </div>
                        <div class="cart-item-buttons">
                            ${zamowButton}
                            <img class="remove-btn" data-id="${item.id}" src="images/bin.png" alt="Usuń" style="cursor: pointer; width: 24px; height: 24px; margin: 10px auto 0;">
                        </div>
                    `;
                    cartContainer.appendChild(itemDiv);
                });
            }

            // Wywołaj funkcję, aby załadować koszyk przy starcie
            updateCartView();
        });


    </script>
</body>
</html>